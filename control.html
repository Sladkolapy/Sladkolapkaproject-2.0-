<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | NFC Lock</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="tg-app">
        <div class="header">
            <h1 id="userName">–ü—Ä–∏–≤–µ—Ç!</h1>
            <div class="lock-status" id="lockStatus">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
        </div>

        <div class="nfc-area">
            <div class="nfc-icon">üì±</div>
            <div class="nfc-hint" id="nfcHint">–ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫ –∑–∞–º–∫—É</div>
        </div>

        <button class="action-btn" id="actionBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="btn-logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = JSON.parse(localStorage.getItem('nfcUser')) || {};
        const urlParams = new URLSearchParams(window.location.search);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑ URL –µ—Å–ª–∏ –µ—Å—Ç—å
        if (urlParams.has('firstName')) {
            userData.firstName = urlParams.get('firstName');
            userData.hash = urlParams.get('hash');
            localStorage.setItem('nfcUser', JSON.stringify(userData));
        }

        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
        if (!userData.firstName) {
            window.location.href = 'index.html';
            return;
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è
        document.getElementById('userName').textContent = `–ü—Ä–∏–≤–µ—Ç, ${userData.firstName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}!`;

        // –õ–æ–≥–∏–∫–∞ –∑–∞–º–∫–∞
        let isLocked = true;
        document.getElementById('actionBtn').onclick = function() {
            isLocked = !isLocked;
            const btn = document.getElementById('actionBtn');
            const status = document.getElementById('lockStatus');
            const hint = document.getElementById('nfcHint');
            
            if (isLocked) {
                btn.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                btn.classList.remove('active');
                status.textContent = 'üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                hint.textContent = '–ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫ –∑–∞–º–∫—É';
            } else {
                btn.textContent = '–û—Ç–∫—Ä—ã—Ç—å';
                btn.classList.add('active');
                status.textContent = 'üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                hint.textContent = '–ì–æ—Ç–æ–≤ –∫ NFC';
                setTimeout(() => hint.textContent = '–ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 800);
            }
        };

        // –í—ã—Ö–æ–¥
        document.getElementById('logoutBtn').onclick = function() {
            localStorage.removeItem('nfcUser');
            window.location.href = 'index.html';
        };
    </script>
    <script type="module">
        import { initControlPage } from './script.js';
        initControlPage();
    </script>
</body>
</html>